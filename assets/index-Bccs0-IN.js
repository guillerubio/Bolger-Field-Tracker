(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const $r=!1;var ds=Array.isArray,yn=Array.prototype.indexOf,lr=Array.from,mn=Object.defineProperty,Gt=Object.getOwnPropertyDescriptor,fs=Object.getOwnPropertyDescriptors,_s=Object.getPrototypeOf;const Bt=()=>{};function wn(r){return r()}function Kt(r){for(var e=0;e<r.length;e++)r[e]()}const K=2,vs=4,Ct=8,cr=16,ne=32,it=64,mt=128,H=256,wt=512,U=1024,ie=2048,Ne=4096,se=8192,xt=16384,bn=32768,ur=65536,kn=1<<17,En=1<<19,ps=1<<20,Wt=Symbol("$state"),Sn=Symbol("legacy props"),Tn=Symbol("");function gs(r){return r===this.v}function ys(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function ms(r){return!ys(r,this.v)}function On(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Pn(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function An(r){throw new Error("https://svelte.dev/e/effect_orphan")}function jn(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function $n(r){throw new Error("https://svelte.dev/e/props_invalid_value")}function Rn(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function Cn(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let Me=!1,xn=!1;function In(){Me=!0}const Ln=1,Dn=2,Un=16,Nn=2,ws=1,Mn=2,Bn=Symbol();function bs(r){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let $=null;function Rr(r){$=r}function hr(r,e=!1,t){$={p:$,c:null,e:null,m:!1,s:r,x:null,l:null},Me&&!e&&($.l={s:null,u:null,r1:[],r2:bt(!1)})}function dr(r){const e=$;if(e!==null){const o=e.e;if(o!==null){var t=P,s=S;e.e=null;try{for(var n=0;n<o.length;n++){var i=o[n];pe(i.effect),ve(i.reaction),Rs(i.fn)}}finally{pe(t),ve(s)}}$=e.p,e.m=!0}return{}}function ot(){return!Me||$!==null&&$.l===null}function bt(r,e){var t={f:0,v:r,reactions:null,equals:gs,rv:0,wv:0};return t}function ks(r,e=!1){var s;const t=bt(r);return e||(t.equals=ms),Me&&$!==null&&$.l!==null&&((s=$.l).s??(s.s=[])).push(t),t}function ge(r,e=!1){return qn(ks(r,e))}function qn(r){return S!==null&&!Y&&S.f&K&&(X===null?ei([r]):X.push(r)),r}function R(r,e){return S!==null&&!Y&&ot()&&S.f&(K|cr)&&(X===null||!X.includes(r))&&Cn(),Es(r,e)}function Es(r,e){return r.equals(e)||(r.v,r.v=e,r.wv=Ms(),Ss(r,ie),ot()&&P!==null&&P.f&U&&!(P.f&(ne|it))&&(te===null?ti([r]):te.push(r))),e}function Ss(r,e){var t=r.reactions;if(t!==null)for(var s=ot(),n=t.length,i=0;i<n;i++){var o=t[i],a=o.f;a&ie||!s&&o===P||(Q(o,e),a&(U|H)&&(a&K?Ss(o,Ne):Dt(o)))}}let fr=!1;var Cr,Ts,Os,Ps;function Fn(){if(Cr===void 0){Cr=window,Ts=/Firefox/.test(navigator.userAgent);var r=Element.prototype,e=Node.prototype;Os=Gt(e,"firstChild").get,Ps=Gt(e,"nextSibling").get,r.__click=void 0,r.__className="",r.__attributes=null,r.__styles=null,r.__e=void 0,Text.prototype.__t=void 0}}function Jn(r=""){return document.createTextNode(r)}function re(r){return Os.call(r)}function It(r){return Ps.call(r)}function z(r,e){return re(r)}function xr(r,e){{var t=re(r);return t instanceof Comment&&t.data===""?It(t):t}}function I(r,e=1,t=!1){let s=r;for(;e--;)s=It(s);return s}function zn(r){r.textContent=""}function _r(r){var e=K|ie,t=S!==null&&S.f&K?S:null;return P===null||t!==null&&t.f&H?e|=H:P.f|=ps,{ctx:$,deps:null,effects:null,equals:gs,f:e,fn:r,reactions:null,rv:0,v:null,wv:0,parent:t??P}}function kt(r){const e=_r(r);return e.equals=ms,e}function As(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)_e(e[t])}}function Hn(r){for(var e=r.parent;e!==null;){if(!(e.f&K))return e;e=e.parent}return null}function Vn(r){var e,t=P;pe(Hn(r));try{As(r),e=qs(r)}finally{pe(t)}return e}function js(r){var e=Vn(r),t=(fe||r.f&H)&&r.deps!==null?Ne:U;Q(r,t),r.equals(e)||(r.v=e,r.wv=Ms())}function $s(r){P===null&&S===null&&An(),S!==null&&S.f&H&&P===null&&Pn(),gr&&On()}function Gn(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function Be(r,e,t,s=!0){var n=(r&it)!==0,i=P,o={ctx:$,deps:null,nodes_start:null,nodes_end:null,f:r|ie,first:null,fn:e,last:null,next:null,parent:n?null:i,prev:null,teardown:null,transitions:null,wv:0};if(t){var a=Ie;try{Ir(!0),yr(o),o.f|=bn}catch(c){throw _e(o),c}finally{Ir(a)}}else e!==null&&Dt(o);var l=t&&o.deps===null&&o.first===null&&o.nodes_start===null&&o.teardown===null&&(o.f&(ps|mt))===0;if(!l&&!n&&s&&(i!==null&&Gn(o,i),S!==null&&S.f&K)){var u=S;(u.effects??(u.effects=[])).push(o)}return o}function Kn(r){const e=Be(Ct,null,!1);return Q(e,U),e.teardown=r,e}function Yt(r){$s();var e=P!==null&&(P.f&ne)!==0&&$!==null&&!$.m;if(e){var t=$;(t.e??(t.e=[])).push({fn:r,effect:P,reaction:S})}else{var s=Rs(r);return s}}function Wn(r){return $s(),Cs(r)}function Yn(r){const e=Be(it,r,!0);return(t={})=>new Promise(s=>{t.outro?Et(e,()=>{_e(e),s(void 0)}):(_e(e),s(void 0))})}function Rs(r){return Be(vs,r,!1)}function Cs(r){return Be(Ct,r,!0)}function Xe(r,e=[],t=_r){const s=e.map(t);return vr(()=>r(...s.map(b)))}function vr(r,e=0){return Be(Ct|cr|e,r,!0)}function st(r,e=!0){return Be(Ct|ne,r,!0,e)}function xs(r){var e=r.teardown;if(e!==null){const t=gr,s=S;Lr(!0),ve(null);try{e.call(null)}finally{Lr(t),ve(s)}}}function Is(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){var s=t.next;_e(t,e),t=s}}function Xn(r){for(var e=r.first;e!==null;){var t=e.next;e.f&ne||_e(e),e=t}}function _e(r,e=!0){var t=!1;if((e||r.f&En)&&r.nodes_start!==null){for(var s=r.nodes_start,n=r.nodes_end;s!==null;){var i=s===n?null:It(s);s.remove(),s=i}t=!0}Is(r,e&&!t),At(r,0),Q(r,xt);var o=r.transitions;if(o!==null)for(const l of o)l.stop();xs(r);var a=r.parent;a!==null&&a.first!==null&&Ls(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes_start=r.nodes_end=null}function Ls(r){var e=r.parent,t=r.prev,s=r.next;t!==null&&(t.next=s),s!==null&&(s.prev=t),e!==null&&(e.first===r&&(e.first=s),e.last===r&&(e.last=t))}function Et(r,e){var t=[];pr(r,t,!0),Ds(t,()=>{_e(r),e&&e()})}function Ds(r,e){var t=r.length;if(t>0){var s=()=>--t||e();for(var n of r)n.out(s)}else e()}function pr(r,e,t){if(!(r.f&se)){if(r.f^=se,r.transitions!==null)for(const o of r.transitions)(o.is_global||t)&&e.push(o);for(var s=r.first;s!==null;){var n=s.next,i=(s.f&ur)!==0||(s.f&ne)!==0;pr(s,e,i?t:!1),s=n}}}function St(r){Us(r,!0)}function Us(r,e){if(r.f&se){r.f^=se,r.f&U||(r.f^=U),at(r)&&(Q(r,ie),Dt(r));for(var t=r.first;t!==null;){var s=t.next,n=(t.f&ur)!==0||(t.f&ne)!==0;Us(t,n?e:!1),t=s}if(r.transitions!==null)for(const i of r.transitions)(i.is_global||e)&&i.in()}}let Xt=!1,Qt=[];function Qn(){Xt=!1;const r=Qt.slice();Qt=[],Kt(r)}function Zn(r){Xt||(Xt=!0,queueMicrotask(Qn)),Qt.push(r)}let gt=!1,Tt=!1,Ot=null,Ie=!1,gr=!1;function Ir(r){Ie=r}function Lr(r){gr=r}let Zt=[],et=0;let S=null,Y=!1;function ve(r){S=r}let P=null;function pe(r){P=r}let X=null;function ei(r){X=r}let D=null,B=0,te=null;function ti(r){te=r}let Ns=1,Pt=0,fe=!1;function Ms(){return++Ns}function at(r){var h;var e=r.f;if(e&ie)return!0;if(e&Ne){var t=r.deps,s=(e&H)!==0;if(t!==null){var n,i,o=(e&wt)!==0,a=s&&P!==null&&!fe,l=t.length;if(o||a){var u=r,c=u.parent;for(n=0;n<l;n++)i=t[n],(o||!((h=i==null?void 0:i.reactions)!=null&&h.includes(u)))&&(i.reactions??(i.reactions=[])).push(u);o&&(u.f^=wt),a&&c!==null&&!(c.f&H)&&(u.f^=H)}for(n=0;n<l;n++)if(i=t[n],at(i)&&js(i),i.wv>r.wv)return!0}(!s||P!==null&&!fe)&&Q(r,U)}return!1}function ri(r,e){for(var t=e;t!==null;){if(t.f&mt)try{t.fn(r);return}catch{t.f^=mt}t=t.parent}throw gt=!1,r}function si(r){return(r.f&xt)===0&&(r.parent===null||(r.parent.f&mt)===0)}function Lt(r,e,t,s){if(gt){if(t===null&&(gt=!1),si(e))throw r;return}t!==null&&(gt=!0);{ri(r,e);return}}function Bs(r,e,t=!0){var s=r.reactions;if(s!==null)for(var n=0;n<s.length;n++){var i=s[n];i.f&K?Bs(i,e,!1):e===i&&(t?Q(i,ie):i.f&U&&Q(i,Ne),Dt(i))}}function qs(r){var f;var e=D,t=B,s=te,n=S,i=fe,o=X,a=$,l=Y,u=r.f;D=null,B=0,te=null,S=u&(ne|it)?null:r,fe=(u&H)!==0&&(!Ie||n===null||l),X=null,Rr(r.ctx),Y=!1,Pt++;try{var c=(0,r.fn)(),h=r.deps;if(D!==null){var d;if(At(r,B),h!==null&&B>0)for(h.length=B+D.length,d=0;d<D.length;d++)h[B+d]=D[d];else r.deps=h=D;if(!fe)for(d=B;d<h.length;d++)((f=h[d]).reactions??(f.reactions=[])).push(r)}else h!==null&&B<h.length&&(At(r,B),h.length=B);if(ot()&&te!==null&&!Y&&h!==null&&!(r.f&(K|Ne|ie)))for(d=0;d<te.length;d++)Bs(te[d],r);return n!==null&&Pt++,c}finally{D=e,B=t,te=s,S=n,fe=i,X=o,Rr(a),Y=l}}function ni(r,e){let t=e.reactions;if(t!==null){var s=yn.call(t,r);if(s!==-1){var n=t.length-1;n===0?t=e.reactions=null:(t[s]=t[n],t.pop())}}t===null&&e.f&K&&(D===null||!D.includes(e))&&(Q(e,Ne),e.f&(H|wt)||(e.f^=wt),As(e),At(e,0))}function At(r,e){var t=r.deps;if(t!==null)for(var s=e;s<t.length;s++)ni(r,t[s])}function yr(r){var e=r.f;if(!(e&xt)){Q(r,U);var t=P,s=$;P=r;try{e&cr?Xn(r):Is(r),xs(r);var n=qs(r);r.teardown=typeof n=="function"?n:null,r.wv=Ns;var i=r.deps,o;$r&&xn&&r.f&ie}catch(a){Lt(a,r,t,s||r.ctx)}finally{P=t}}}function ii(){if(et>1e3){et=0;try{jn()}catch(r){if(Ot!==null)Lt(r,Ot,null);else throw r}}et++}function oi(r){var e=r.length;if(e!==0){ii();var t=Ie;Ie=!0;try{for(var s=0;s<e;s++){var n=r[s];n.f&U||(n.f^=U);var i=ci(n);ai(i)}}finally{Ie=t}}}function ai(r){var e=r.length;if(e!==0)for(var t=0;t<e;t++){var s=r[t];if(!(s.f&(xt|se)))try{at(s)&&(yr(s),s.deps===null&&s.first===null&&s.nodes_start===null&&(s.teardown===null?Ls(s):s.fn=null))}catch(n){Lt(n,s,null,s.ctx)}}}function li(){if(Tt=!1,et>1001)return;const r=Zt;Zt=[],oi(r),Tt||(et=0,Ot=null)}function Dt(r){Tt||(Tt=!0,queueMicrotask(li)),Ot=r;for(var e=r;e.parent!==null;){e=e.parent;var t=e.f;if(t&(it|ne)){if(!(t&U))return;e.f^=U}}Zt.push(e)}function ci(r){var e=[],t=r.first;e:for(;t!==null;){var s=t.f,n=(s&ne)!==0,i=n&&(s&U)!==0,o=t.next;if(!i&&!(s&se)){if(s&vs)e.push(t);else if(n)t.f^=U;else{var a=S;try{S=t,at(t)&&yr(t)}catch(c){Lt(c,t,null,t.ctx)}finally{S=a}}var l=t.first;if(l!==null){t=l;continue}}if(o===null){let c=t.parent;for(;c!==null;){if(r===c)break e;var u=c.next;if(u!==null){t=u;continue e}c=c.parent}}t=o}return e}function b(r){var e=r.f,t=(e&K)!==0;if(S!==null&&!Y){X!==null&&X.includes(r)&&Rn();var s=S.deps;r.rv<Pt&&(r.rv=Pt,D===null&&s!==null&&s[B]===r?B++:D===null?D=[r]:(!fe||!D.includes(r))&&D.push(r))}else if(t&&r.deps===null&&r.effects===null){var n=r,i=n.parent;i!==null&&!(i.f&H)&&(n.f^=H)}return t&&(n=r,at(n)&&js(n)),r.v}function Ut(r){var e=Y;try{return Y=!0,r()}finally{Y=e}}const ui=-7169;function Q(r,e){r.f=r.f&ui|e}function hi(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(Wt in r)er(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&Wt in t&&er(t)}}}function er(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let s in r)try{er(r[s],e)}catch{}const t=_s(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const s=fs(t);for(let n in s){const i=s[n].get;if(i)try{i.call(r)}catch{}}}}}const di=["touchstart","touchmove"];function fi(r){return di.includes(r)}let Dr=!1;function _i(){Dr||(Dr=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{var e;if(!r.defaultPrevented)for(const t of r.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function Fs(r){var e=S,t=P;ve(null),pe(null);try{return r()}finally{ve(e),pe(t)}}function vi(r,e,t,s=t){r.addEventListener(e,()=>Fs(t));const n=r.__on_r;n?r.__on_r=()=>{n(),s(!0)}:r.__on_r=()=>s(!0),_i()}const pi=new Set,Ur=new Set;function gi(r,e,t,s={}){function n(i){if(s.capture||Qe.call(e,i),!i.cancelBubble)return Fs(()=>t==null?void 0:t.call(this,i))}return r.startsWith("pointer")||r.startsWith("touch")||r==="wheel"?Zn(()=>{e.addEventListener(r,n,s)}):e.addEventListener(r,n,s),n}function Z(r,e,t,s,n){var i={capture:s,passive:n},o=gi(r,e,t,i);(e===document.body||e===window||e===document)&&Kn(()=>{e.removeEventListener(r,o,i)})}function Qe(r){var A;var e=this,t=e.ownerDocument,s=r.type,n=((A=r.composedPath)==null?void 0:A.call(r))||[],i=n[0]||r.target,o=0,a=r.__root;if(a){var l=n.indexOf(a);if(l!==-1&&(e===document||e===window)){r.__root=e;return}var u=n.indexOf(e);if(u===-1)return;l<=u&&(o=l)}if(i=n[o]||r.target,i!==e){mn(r,"currentTarget",{configurable:!0,get(){return i||t}});var c=S,h=P;ve(null),pe(null);try{for(var d,f=[];i!==null;){var _=i.assignedSlot||i.parentNode||i.host||null;try{var v=i["__"+s];if(v!==void 0&&!i.disabled)if(ds(v)){var[p,...y]=v;p.apply(i,[r,...y])}else v.call(i,r)}catch(T){d?f.push(T):d=T}if(r.cancelBubble||_===e||_===null)break;i=_}if(d){for(let T of f)queueMicrotask(()=>{throw T});throw d}}finally{r.__root=e,delete r.currentTarget,ve(c),pe(h)}}}function Js(r){var e=document.createElement("template");return e.innerHTML=r,e.content}function jt(r,e){var t=P;t.nodes_start===null&&(t.nodes_start=r,t.nodes_end=e)}function qe(r,e){var t=(e&ws)!==0,s=(e&Mn)!==0,n,i=!r.startsWith("<!>");return()=>{n===void 0&&(n=Js(i?r:"<!>"+r),t||(n=re(n)));var o=s||Ts?document.importNode(n,!0):n.cloneNode(!0);if(t){var a=re(o),l=o.lastChild;jt(a,l)}else jt(o,o);return o}}function zs(r,e,t="svg"){var s=!r.startsWith("<!>"),n=(e&ws)!==0,i=`<${t}>${s?r:"<!>"+r}</${t}>`,o;return()=>{if(!o){var a=Js(i),l=re(a);if(n)for(o=document.createDocumentFragment();re(l);)o.appendChild(re(l));else o=re(l)}var u=o.cloneNode(!0);if(n){var c=re(u),h=u.lastChild;jt(c,h)}else jt(u,u);return u}}function ce(r,e){r!==null&&r.before(e)}function $t(r,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(r.__t??(r.__t=r.nodeValue))&&(r.__t=t,r.nodeValue=t+"")}function yi(r,e){return mi(r,e)}const Se=new Map;function mi(r,{target:e,anchor:t,props:s={},events:n,context:i,intro:o=!0}){Fn();var a=new Set,l=h=>{for(var d=0;d<h.length;d++){var f=h[d];if(!a.has(f)){a.add(f);var _=fi(f);e.addEventListener(f,Qe,{passive:_});var v=Se.get(f);v===void 0?(document.addEventListener(f,Qe,{passive:_}),Se.set(f,1)):Se.set(f,v+1)}}};l(lr(pi)),Ur.add(l);var u=void 0,c=Yn(()=>{var h=t??e.appendChild(Jn());return st(()=>{if(i){hr({});var d=$;d.c=i}n&&(s.$$events=n),u=r(h,s)||{},i&&dr()}),()=>{var _;for(var d of a){e.removeEventListener(d,Qe);var f=Se.get(d);--f===0?(document.removeEventListener(d,Qe),Se.delete(d)):Se.set(d,f)}Ur.delete(l),h!==t&&((_=h.parentNode)==null||_.removeChild(h))}});return wi.set(u,c),u}let wi=new WeakMap;function Ve(r,e,t=!1){var s=r,n=null,i=null,o=Bn,a=t?ur:0,l=!1;const u=(h,d=!0)=>{l=!0,c(d,h)},c=(h,d)=>{o!==(o=h)&&(o?(n?St(n):d&&(n=st(()=>d(s))),i&&Et(i,()=>{i=null})):(i?St(i):d&&(i=st(()=>d(s))),n&&Et(n,()=>{n=null})))};vr(()=>{l=!1,e(u),l||c(null,null)},a)}function bi(r,e){return e}function ki(r,e,t,s){for(var n=[],i=e.length,o=0;o<i;o++)pr(e[o].e,n,!0);var a=i>0&&n.length===0&&t!==null;if(a){var l=t.parentNode;zn(l),l.append(t),s.clear(),ue(r,e[0].prev,e[i-1].next)}Ds(n,()=>{for(var u=0;u<i;u++){var c=e[u];a||(s.delete(c.k),ue(r,c.prev,c.next)),_e(c.e,!a)}})}function Ei(r,e,t,s,n,i=null){var o=r,a={flags:e,items:new Map,first:null},l=null,u=!1,c=kt(()=>{var h=t();return ds(h)?h:h==null?[]:lr(h)});vr(()=>{var h=b(c),d=h.length;u&&d===0||(u=d===0,Si(h,a,o,n,e,s,t),i!==null&&(d===0?l?St(l):l=st(()=>i(o)):l!==null&&Et(l,()=>{l=null})),b(c))})}function Si(r,e,t,s,n,i,o){var a=r.length,l=e.items,u=e.first,c=u,h,d=null,f=[],_=[],v,p,y,A;for(A=0;A<a;A+=1){if(v=r[A],p=i(v,A),y=l.get(p),y===void 0){var T=c?c.e.nodes_start:t;d=Oi(T,e,d,d===null?e.first:d.next,v,p,A,s,n,o),l.set(p,d),f=[],_=[],c=d.next;continue}if(Ti(y,v,A),y.e.f&se&&St(y.e),y!==c){if(h!==void 0&&h.has(y)){if(f.length<_.length){var j=_[0],E;d=j.prev;var ct=f[0],Je=f[f.length-1];for(E=0;E<f.length;E+=1)Nr(f[E],j,t);for(E=0;E<_.length;E+=1)h.delete(_[E]);ue(e,ct.prev,Je.next),ue(e,d,ct),ue(e,Je,j),c=j,d=Je,A-=1,f=[],_=[]}else h.delete(y),Nr(y,c,t),ue(e,y.prev,y.next),ue(e,y,d===null?e.first:d.next),ue(e,d,y),d=y;continue}for(f=[],_=[];c!==null&&c.k!==p;)c.e.f&se||(h??(h=new Set)).add(c),_.push(c),c=c.next;if(c===null)continue;y=c}f.push(y),d=y,c=y.next}if(c!==null||h!==void 0){for(var ze=h===void 0?[]:lr(h);c!==null;)c.e.f&se||ze.push(c),c=c.next;var ut=ze.length;if(ut>0){var He=null;ki(e,ze,He,l)}}P.first=e.first&&e.first.e,P.last=d&&d.e}function Ti(r,e,t,s){Es(r.v,e),r.i=t}function Oi(r,e,t,s,n,i,o,a,l,u){var c=(l&Ln)!==0,h=(l&Un)===0,d=c?h?ks(n):bt(n):n,f=l&Dn?bt(o):o,_={i:f,v:d,k:i,a:null,e:null,prev:t,next:s};try{return _.e=st(()=>a(r,d,f,u),fr),_.e.prev=t&&t.e,_.e.next=s&&s.e,t===null?e.first=_:(t.next=_,t.e.next=_.e),s!==null&&(s.prev=_,s.e.prev=_.e),_}finally{}}function Nr(r,e,t){for(var s=r.next?r.next.e.nodes_start:t,n=e?e.e.nodes_start:t,i=r.e.nodes_start;i!==s;){var o=It(i);n.before(i),i=o}}function ue(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Ge(r,e,t,s){var n=r.__attributes??(r.__attributes={});n[e]!==(n[e]=t)&&(e==="style"&&"__styles"in r&&(r.__styles={}),e==="loading"&&(r[Tn]=t),t==null?r.removeAttribute(e):typeof t!="string"&&Pi(r).includes(e)?r[e]=t:r.setAttribute(e,t))}var Mr=new Map;function Pi(r){var e=Mr.get(r.nodeName);if(e)return e;Mr.set(r.nodeName,e=[]);for(var t,s=r,n=Element.prototype;n!==s;){t=fs(s);for(var i in t)t[i].set&&e.push(i);s=_s(s)}return e}function Ai(r,e,t){var s=r.__className,n=Hs(e);(s!==n||fr)&&(n===""?r.removeAttribute("class"):r.setAttribute("class",n),r.__className=n)}function ji(r,e,t){var s=r.__className,n=Hs(e);(s!==n||fr)&&(e==null?r.removeAttribute("class"):r.className=n,r.__className=n)}function Hs(r,e){return(r??"")+""}function Br(r,e,t=e){var s=ot();vi(r,"input",n=>{var i=n?r.defaultValue:r.value;if(i=qt(r)?Ft(i):i,t(i),s&&i!==(i=e())){var o=r.selectionStart,a=r.selectionEnd;r.value=i??"",a!==null&&(r.selectionStart=o,r.selectionEnd=Math.min(a,r.value.length))}}),Ut(e)==null&&r.value&&t(qt(r)?Ft(r.value):r.value),Cs(()=>{var n=e();qt(r)&&n===Ft(r.value)||r.type==="date"&&!n&&!r.value||n!==r.value&&(r.value=n??"")})}function qt(r){var e=r.type;return e==="number"||e==="range"}function Ft(r){return r===""?null:+r}function Vs(r=!1){const e=$,t=e.l.u;if(!t)return;let s=()=>hi(e.s);if(r){let n=0,i={};const o=_r(()=>{let a=!1;const l=e.s;for(const u in l)l[u]!==i[u]&&(i[u]=l[u],a=!0);return a&&n++,n});s=()=>b(o)}t.b.length&&Wn(()=>{qr(e,s),Kt(t.b)}),Yt(()=>{const n=Ut(()=>t.m.map(wn));return()=>{for(const i of n)typeof i=="function"&&i()}}),t.a.length&&Yt(()=>{qr(e,s),Kt(t.a)})}function qr(r,e){if(r.l.s)for(const t of r.l.s)b(t);e()}const Te=[];function $i(r,e=Bt){let t=null;const s=new Set;function n(a){if(ys(r,a)&&(r=a,t)){const l=!Te.length;for(const u of s)u[1](),Te.push(u,r);if(l){for(let u=0;u<Te.length;u+=2)Te[u][0](Te[u+1]);Te.length=0}}}function i(a){n(a(r))}function o(a,l=Bt){const u=[a,l];return s.add(u),s.size===1&&(t=e(n,i)||Bt),a(r),()=>{s.delete(u),s.size===0&&t&&(t(),t=null)}}return{set:n,update:i,subscribe:o}}let ht=!1;function Ri(r){var e=ht;try{return ht=!1,[r(),ht]}finally{ht=e}}function yt(r,e,t,s){var _;var n=!Me||(t&Nn)!==0,i=!1,o;[o,i]=Ri(()=>r[e]);var a=Wt in r||Sn in r,l=(((_=Gt(r,e))==null?void 0:_.set)??(a&&e in r&&(v=>r[e]=v)))||void 0,u=s,c=!0,h=()=>(c&&(c=!1,u=s),u);o===void 0&&s!==void 0&&(l&&n&&$n(),o=h(),l&&l(o));var d;if(n)d=()=>{var v=r[e];return v===void 0?h():(c=!0,v)};else{var f=kt(()=>r[e]);f.f|=kn,d=()=>{var v=b(f);return v!==void 0&&(u=void 0),v===void 0?u:v}}return d}function Ci(r){$===null&&bs(),Me&&$.l!==null?Ii($).m.push(r):Yt(()=>{const e=Ut(r);if(typeof e=="function")return e})}function xi(r){$===null&&bs(),Ci(()=>()=>Ut(r))}function Ii(r){var e=r.l;return e.u??(e.u={a:[],b:[],m:[]})}const Li="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Li);In();const Di="modulepreload",Ui=function(r){return"/Bolger-Field-Tracker/"+r},Fr={},De=function(e,t,s){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=Promise.allSettled(t.map(l=>{if(l=Ui(l),l in Fr)return;Fr[l]=!0;const u=l.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${c}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":Di,u||(h.as="script"),h.crossOrigin="",h.href=l,a&&h.setAttribute("nonce",a),document.head.appendChild(h),u)return new Promise((d,f)=>{h.addEventListener("load",d),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return n.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},Ni=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>De(async()=>{const{default:s}=await Promise.resolve().then(()=>Fe);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class mr extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Mi extends mr{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Bi extends mr{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class qi extends mr{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var tr;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(tr||(tr={}));var Fi=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):n(c.value).then(a,l)}u((s=s.apply(r,e||[])).next())})};class Ji{constructor(e,{headers:t={},customFetch:s,region:n=tr.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=Ni(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Fi(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:o}=t;let a={},{region:l}=t;l||(l=this.region),l&&l!=="any"&&(a["x-region"]=l);let u;o&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=o):typeof o=="string"?(a["Content-Type"]="text/plain",u=o):typeof FormData<"u"&&o instanceof FormData?u=o:(a["Content-Type"]="application/json",u=JSON.stringify(o)));const c=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),n),body:u}).catch(_=>{throw new Mi(_)}),h=c.headers.get("x-relay-error");if(h&&h==="true")throw new Bi(c);if(!c.ok)throw new qi(c);let d=((s=c.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),f;return d==="application/json"?f=yield c.json():d==="application/octet-stream"?f=yield c.blob():d==="text/event-stream"?f=c:d==="multipart/form-data"?f=yield c.formData():f=yield c.text(),{data:f,error:null}}catch(n){return{data:null,error:n}}})}}function zi(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Hi(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(s){var n=Object.getOwnPropertyDescriptor(r,s);Object.defineProperty(t,s,n.get?n:{enumerable:!0,get:function(){return r[s]}})}),t}var C={},Oe={},Pe={},Ae={},je={},$e={},Vi=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Ue=Vi();const Gi=Ue.fetch,Gs=Ue.fetch.bind(Ue),Ks=Ue.Headers,Ki=Ue.Request,Wi=Ue.Response,Fe=Object.freeze(Object.defineProperty({__proto__:null,Headers:Ks,Request:Ki,Response:Wi,default:Gs,fetch:Gi},Symbol.toStringTag,{value:"Module"})),Yi=Hi(Fe);var dt={},Jr;function Ws(){if(Jr)return dt;Jr=1,Object.defineProperty(dt,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return dt.default=r,dt}var zr;function Ys(){if(zr)return $e;zr=1;var r=$e&&$e.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty($e,"__esModule",{value:!0});const e=r(Yi),t=r(Ws());class s{constructor(i){this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=i.headers,this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=i.shouldThrowOnError,this.signal=i.signal,this.isMaybeSingle=i.isMaybeSingle,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,o){return this.headers=Object.assign({},this.headers),this.headers[i]=o,this}then(i,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let l=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{var c,h,d;let f=null,_=null,v=null,p=u.status,y=u.statusText;if(u.ok){if(this.method!=="HEAD"){const E=await u.text();E===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?_=E:_=JSON.parse(E))}const T=(c=this.headers.Prefer)===null||c===void 0?void 0:c.match(/count=(exact|planned|estimated)/),j=(h=u.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");T&&j&&j.length>1&&(v=parseInt(j[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(_)&&(_.length>1?(f={code:"PGRST116",details:`Results contain ${_.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},_=null,v=null,p=406,y="Not Acceptable"):_.length===1?_=_[0]:_=null)}else{const T=await u.text();try{f=JSON.parse(T),Array.isArray(f)&&u.status===404&&(_=[],f=null,p=200,y="OK")}catch{u.status===404&&T===""?(p=204,y="No Content"):f={message:T}}if(f&&this.isMaybeSingle&&(!((d=f==null?void 0:f.details)===null||d===void 0)&&d.includes("0 rows"))&&(f=null,p=200,y="OK"),f&&this.shouldThrowOnError)throw new t.default(f)}return{error:f,data:_,count:v,status:p,statusText:y}});return this.shouldThrowOnError||(l=l.catch(u=>{var c,h,d;return{error:{message:`${(c=u==null?void 0:u.name)!==null&&c!==void 0?c:"FetchError"}: ${u==null?void 0:u.message}`,details:`${(h=u==null?void 0:u.stack)!==null&&h!==void 0?h:""}`,hint:"",code:`${(d=u==null?void 0:u.code)!==null&&d!==void 0?d:""}`},data:null,count:null,status:0,statusText:""}})),l.then(i,o)}}return $e.default=s,$e}var Hr;function Xs(){if(Hr)return je;Hr=1;var r=je&&je.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(je,"__esModule",{value:!0});const e=r(Ys());class t extends e.default{select(n){let i=!1;const o=(n??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(n,{ascending:i=!0,nullsFirst:o,foreignTable:a,referencedTable:l=a}={}){const u=l?`${l}.order`:"order",c=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${c?`${c},`:""}${n}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:i,referencedTable:o=i}={}){const a=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(a,`${n}`),this}range(n,i,{foreignTable:o,referencedTable:a=o}={}){const l=typeof a>"u"?"offset":`${a}.offset`,u=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${n}`),this.url.searchParams.set(u,`${i-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:n=!1,verbose:i=!1,settings:o=!1,buffers:a=!1,wal:l=!1,format:u="text"}={}){var c;const h=[n?"analyze":null,i?"verbose":null,o?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),d=(c=this.headers.Accept)!==null&&c!==void 0?c:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${u}; for="${d}"; options=${h};`,u==="json"?this:this}rollback(){var n;return((n=this.headers.Prefer)!==null&&n!==void 0?n:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return je.default=t,je}var Vr;function wr(){if(Vr)return Ae;Vr=1;var r=Ae&&Ae.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ae,"__esModule",{value:!0});const e=r(Xs());class t extends e.default{eq(n,i){return this.url.searchParams.append(n,`eq.${i}`),this}neq(n,i){return this.url.searchParams.append(n,`neq.${i}`),this}gt(n,i){return this.url.searchParams.append(n,`gt.${i}`),this}gte(n,i){return this.url.searchParams.append(n,`gte.${i}`),this}lt(n,i){return this.url.searchParams.append(n,`lt.${i}`),this}lte(n,i){return this.url.searchParams.append(n,`lte.${i}`),this}like(n,i){return this.url.searchParams.append(n,`like.${i}`),this}likeAllOf(n,i){return this.url.searchParams.append(n,`like(all).{${i.join(",")}}`),this}likeAnyOf(n,i){return this.url.searchParams.append(n,`like(any).{${i.join(",")}}`),this}ilike(n,i){return this.url.searchParams.append(n,`ilike.${i}`),this}ilikeAllOf(n,i){return this.url.searchParams.append(n,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(n,i){return this.url.searchParams.append(n,`ilike(any).{${i.join(",")}}`),this}is(n,i){return this.url.searchParams.append(n,`is.${i}`),this}in(n,i){const o=Array.from(new Set(i)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(n,`in.(${o})`),this}contains(n,i){return typeof i=="string"?this.url.searchParams.append(n,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(n,`cs.{${i.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(i)}`),this}containedBy(n,i){return typeof i=="string"?this.url.searchParams.append(n,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(n,`cd.{${i.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(i)}`),this}rangeGt(n,i){return this.url.searchParams.append(n,`sr.${i}`),this}rangeGte(n,i){return this.url.searchParams.append(n,`nxl.${i}`),this}rangeLt(n,i){return this.url.searchParams.append(n,`sl.${i}`),this}rangeLte(n,i){return this.url.searchParams.append(n,`nxr.${i}`),this}rangeAdjacent(n,i){return this.url.searchParams.append(n,`adj.${i}`),this}overlaps(n,i){return typeof i=="string"?this.url.searchParams.append(n,`ov.${i}`):this.url.searchParams.append(n,`ov.{${i.join(",")}}`),this}textSearch(n,i,{config:o,type:a}={}){let l="";a==="plain"?l="pl":a==="phrase"?l="ph":a==="websearch"&&(l="w");const u=o===void 0?"":`(${o})`;return this.url.searchParams.append(n,`${l}fts${u}.${i}`),this}match(n){return Object.entries(n).forEach(([i,o])=>{this.url.searchParams.append(i,`eq.${o}`)}),this}not(n,i,o){return this.url.searchParams.append(n,`not.${i}.${o}`),this}or(n,{foreignTable:i,referencedTable:o=i}={}){const a=o?`${o}.or`:"or";return this.url.searchParams.append(a,`(${n})`),this}filter(n,i,o){return this.url.searchParams.append(n,`${i}.${o}`),this}}return Ae.default=t,Ae}var Gr;function Qs(){if(Gr)return Pe;Gr=1;var r=Pe&&Pe.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Pe,"__esModule",{value:!0});const e=r(wr());class t{constructor(n,{headers:i={},schema:o,fetch:a}){this.url=n,this.headers=i,this.schema=o,this.fetch=a}select(n,{head:i=!1,count:o}={}){const a=i?"HEAD":"GET";let l=!1;const u=(n??"*").split("").map(c=>/\s/.test(c)&&!l?"":(c==='"'&&(l=!l),c)).join("");return this.url.searchParams.set("select",u),o&&(this.headers.Prefer=`count=${o}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(n,{count:i,defaultToNull:o=!0}={}){const a="POST",l=[];if(this.headers.Prefer&&l.push(this.headers.Prefer),i&&l.push(`count=${i}`),o||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(n)){const u=n.reduce((c,h)=>c.concat(Object.keys(h)),[]);if(u.length>0){const c=[...new Set(u)].map(h=>`"${h}"`);this.url.searchParams.set("columns",c.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}upsert(n,{onConflict:i,ignoreDuplicates:o=!1,count:a,defaultToNull:l=!0}={}){const u="POST",c=[`resolution=${o?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&c.push(this.headers.Prefer),a&&c.push(`count=${a}`),l||c.push("missing=default"),this.headers.Prefer=c.join(","),Array.isArray(n)){const h=n.reduce((d,f)=>d.concat(Object.keys(f)),[]);if(h.length>0){const d=[...new Set(h)].map(f=>`"${f}"`);this.url.searchParams.set("columns",d.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}update(n,{count:i}={}){const o="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),this.headers.Prefer=a.join(","),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}delete({count:n}={}){const i="DELETE",o=[];return n&&o.push(`count=${n}`),this.headers.Prefer&&o.unshift(this.headers.Prefer),this.headers.Prefer=o.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return Pe.default=t,Pe}var Ke={},We={},Kr;function Xi(){return Kr||(Kr=1,Object.defineProperty(We,"__esModule",{value:!0}),We.version=void 0,We.version="0.0.0-automated"),We}var Wr;function Qi(){if(Wr)return Ke;Wr=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.DEFAULT_HEADERS=void 0;const r=Xi();return Ke.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${r.version}`},Ke}var Yr;function Zi(){if(Yr)return Oe;Yr=1;var r=Oe&&Oe.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Oe,"__esModule",{value:!0});const e=r(Qs()),t=r(wr()),s=Qi();class n{constructor(o,{headers:a={},schema:l,fetch:u}={}){this.url=o,this.headers=Object.assign(Object.assign({},s.DEFAULT_HEADERS),a),this.schemaName=l,this.fetch=u}from(o){const a=new URL(`${this.url}/${o}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new n(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,a={},{head:l=!1,get:u=!1,count:c}={}){let h;const d=new URL(`${this.url}/rpc/${o}`);let f;l||u?(h=l?"HEAD":"GET",Object.entries(a).filter(([v,p])=>p!==void 0).map(([v,p])=>[v,Array.isArray(p)?`{${p.join(",")}}`:`${p}`]).forEach(([v,p])=>{d.searchParams.append(v,p)})):(h="POST",f=a);const _=Object.assign({},this.headers);return c&&(_.Prefer=`count=${c}`),new t.default({method:h,url:d,headers:_,schema:this.schemaName,body:f,fetch:this.fetch,allowEmpty:!1})}}return Oe.default=n,Oe}var Xr;function eo(){if(Xr)return C;Xr=1;var r=C&&C.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(C,"__esModule",{value:!0}),C.PostgrestError=C.PostgrestBuilder=C.PostgrestTransformBuilder=C.PostgrestFilterBuilder=C.PostgrestQueryBuilder=C.PostgrestClient=void 0;const e=r(Zi());C.PostgrestClient=e.default;const t=r(Qs());C.PostgrestQueryBuilder=t.default;const s=r(wr());C.PostgrestFilterBuilder=s.default;const n=r(Xs());C.PostgrestTransformBuilder=n.default;const i=r(Ys());C.PostgrestBuilder=i.default;const o=r(Ws());return C.PostgrestError=o.default,C.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:s.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:i.default,PostgrestError:o.default},C}var to=eo();const ro=zi(to),{PostgrestClient:so,PostgrestQueryBuilder:Ya,PostgrestFilterBuilder:Xa,PostgrestTransformBuilder:Qa,PostgrestBuilder:Za,PostgrestError:el}=ro,no="2.11.2",io={"X-Client-Info":`realtime-js/${no}`},oo="1.0.0",Zs=1e4,ao=1e3;var Le;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(Le||(Le={}));var q;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(q||(q={}));var G;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(G||(G={}));var rr;(function(r){r.websocket="websocket"})(rr||(rr={}));var we;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(we||(we={}));class lo{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const n=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=s.decode(e.slice(o,o+n));o=o+n;const l=s.decode(e.slice(o,o+i));o=o+i;const u=JSON.parse(s.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:l,payload:u}}}class en{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var O;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(O||(O={}));const Qr=(r,e,t={})=>{var s;const n=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((i,o)=>(i[o]=co(o,r,e,n),i),{})},co=(r,e,t,s)=>{const n=e.find(a=>a.name===r),i=n==null?void 0:n.type,o=t[r];return i&&!s.includes(i)?tn(i,o):sr(o)},tn=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return _o(e,t)}switch(r){case O.bool:return uo(e);case O.float4:case O.float8:case O.int2:case O.int4:case O.int8:case O.numeric:case O.oid:return ho(e);case O.json:case O.jsonb:return fo(e);case O.timestamp:return vo(e);case O.abstime:case O.date:case O.daterange:case O.int4range:case O.int8range:case O.money:case O.reltime:case O.text:case O.time:case O.timestamptz:case O.timetz:case O.tsrange:case O.tstzrange:return sr(e);default:return sr(e)}},sr=r=>r,uo=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},ho=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},fo=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},_o=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let i;const o=r.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>tn(e,a))}return r},vo=r=>typeof r=="string"?r.replace(" ","T"):r,rn=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Jt{constructor(e,t,s={},n=Zs){this.channel=e,this.event=t,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Zr;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Zr||(Zr={}));class tt{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=tt.syncState(this.state,n,i,o),this.pendingDiffs.forEach(l=>{this.state=tt.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(s.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=tt.syncDiff(this.state,n,i,o),a())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,n){const i=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(i,(u,c)=>{o[u]||(l[u]=c)}),this.map(o,(u,c)=>{const h=i[u];if(h){const d=c.map(p=>p.presence_ref),f=h.map(p=>p.presence_ref),_=c.filter(p=>f.indexOf(p.presence_ref)<0),v=h.filter(p=>d.indexOf(p.presence_ref)<0);_.length>0&&(a[u]=_),v.length>0&&(l[u]=v)}else a[u]=c}),this.syncDiff(i,{joins:a,leaves:l},s,n)}static syncDiff(e,t,s,n){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(i,(a,l)=>{var u;const c=(u=e[a])!==null&&u!==void 0?u:[];if(e[a]=this.cloneDeep(l),c.length>0){const h=e[a].map(f=>f.presence_ref),d=c.filter(f=>h.indexOf(f.presence_ref)<0);e[a].unshift(...d)}s(a,c,l)}),this.map(o,(a,l)=>{let u=e[a];if(!u)return;const c=l.map(h=>h.presence_ref);u=u.filter(h=>c.indexOf(h.presence_ref)<0),e[a]=u,n(a,u,l),u.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const n=e[s];return"metas"in n?t[s]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var es;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(es||(es={}));var ts;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(ts||(ts={}));var ee;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(ee||(ee={}));class br{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=q.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Jt(this,G.join,this.params,this.timeout),this.rejoinTimer=new en(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=q.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=q.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=q.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=q.errored,this.rejoinTimer.scheduleTimeout())}),this._on(G.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new tt(this),this.broadcastEndpointURL=rn(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,n;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:o,private:a}}=this.params;this._onError(c=>e==null?void 0:e(ee.CHANNEL_ERROR,c)),this._onClose(()=>e==null?void 0:e(ee.CLOSED));const l={},u={broadcast:i,presence:o,postgres_changes:(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(c=>c.filter))!==null&&n!==void 0?n:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:u},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:c})=>{var h;if(this.socket.setAuth(),c===void 0){e==null||e(ee.SUBSCRIBED);return}else{const d=this.bindings.postgres_changes,f=(h=d==null?void 0:d.length)!==null&&h!==void 0?h:0,_=[];for(let v=0;v<f;v++){const p=d[v],{filter:{event:y,schema:A,table:T,filter:j}}=p,E=c&&c[v];if(E&&E.event===y&&E.schema===A&&E.table===T&&E.filter===j)_.push(Object.assign(Object.assign({},p),{id:E.id}));else{this.unsubscribe(),e==null||e(ee.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=_,e&&e(ee.SUBSCRIBED);return}}).receive("error",c=>{e==null||e(ee.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(c).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(ee.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=u.body)===null||n===void 0?void 0:n.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=q.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(G.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{const n=new Jt(this,G.leave,{},e);n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}async _fetchWithTimeout(e,t,s){const n=new AbortController,i=setTimeout(()=>n.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),o}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Jt(this,e,t,s);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var n,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:u,join:c}=G;if(s&&[a,l,u,c].indexOf(o)>=0&&s!==this._joinRef())return;let d=this._onMessage(o,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(f=>{var _,v,p;return((_=f.filter)===null||_===void 0?void 0:_.event)==="*"||((p=(v=f.filter)===null||v===void 0?void 0:v.event)===null||p===void 0?void 0:p.toLocaleLowerCase())===o}).map(f=>f.callback(d,s)):(i=this.bindings[o])===null||i===void 0||i.filter(f=>{var _,v,p,y,A,T;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const j=f.id,E=(_=f.filter)===null||_===void 0?void 0:_.event;return j&&((v=t.ids)===null||v===void 0?void 0:v.includes(j))&&(E==="*"||(E==null?void 0:E.toLocaleLowerCase())===((p=t.data)===null||p===void 0?void 0:p.type.toLocaleLowerCase()))}else{const j=(A=(y=f==null?void 0:f.filter)===null||y===void 0?void 0:y.event)===null||A===void 0?void 0:A.toLocaleLowerCase();return j==="*"||j===((T=t==null?void 0:t.event)===null||T===void 0?void 0:T.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof d=="object"&&"ids"in d){const _=d.data,{schema:v,table:p,commit_timestamp:y,type:A,errors:T}=_;d=Object.assign(Object.assign({},{schema:v,table:p,commit_timestamp:y,eventType:A,new:{},old:{},errors:T}),this._getPayloadRecords(_))}f.callback(d,s)})}_isClosed(){return this.state===q.closed}_isJoined(){return this.state===q.joined}_isJoining(){return this.state===q.joining}_isLeaving(){return this.state===q.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:s};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&br.isEqual(n.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(G.close,{},e)}_onError(e){this._on(G.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=q.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Qr(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Qr(e.columns,e.old_record)),t}}const po=()=>{},go=typeof WebSocket<"u",yo=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class mo{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=io,this.params={},this.timeout=Zs,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=po,this.conn=null,this.sendBuffer=[],this.serializer=new lo,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...a)=>De(async()=>{const{default:l}=await Promise.resolve().then(()=>Fe);return{default:l}},void 0).then(({default:l})=>l(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${rr.websocket}`,this.httpEndpoint=rn(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const n=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new en(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(go){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new wo(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),De(async()=>{const{default:e}=await import("./browser-BzP45hhM.js").then(t=>t.b);return{default:e}},[]).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:oo}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Le.connecting:return we.Connecting;case Le.open:return we.Open;case Le.closing:return we.Closing;default:return we.Closed}}isConnected(){return this.connectionState()===we.Open}channel(e,t={config:{}}){const s=new br(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:n,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${s} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let s=null;try{s=JSON.parse(atob(t.split(".")[1]))}catch{}if(s&&s.exp&&!(Math.floor(Date.now()/1e3)-s.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`);this.accessTokenValue=t,this.channels.forEach(n=>{t&&n.updateJoinPayload({access_token:t}),n.joinedOnce&&n._isJoined()&&n._push(G.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(ao,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:n,payload:i,ref:o}=t;o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${s} ${n} ${o&&"("+o+")"||""}`,i),this.channels.filter(a=>a._isMember(s)).forEach(a=>a._trigger(n,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(G.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${s}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([yo],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class wo{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Le.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class kr extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function x(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class bo extends kr{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class nr extends kr{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var ko=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):n(c.value).then(a,l)}u((s=s.apply(r,e||[])).next())})};const sn=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>De(async()=>{const{default:s}=await Promise.resolve().then(()=>Fe);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Eo=()=>ko(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield De(()=>Promise.resolve().then(()=>Fe),void 0)).Response:Response}),ir=r=>{if(Array.isArray(r))return r.map(t=>ir(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=ir(s)}),e};var be=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):n(c.value).then(a,l)}u((s=s.apply(r,e||[])).next())})};const zt=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),So=(r,e,t)=>be(void 0,void 0,void 0,function*(){const s=yield Eo();r instanceof s&&!(t!=null&&t.noResolveJson)?r.json().then(n=>{e(new bo(zt(n),r.status||500))}).catch(n=>{e(new nr(zt(n),n))}):e(new nr(zt(r),r))}),To=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s&&(n.body=JSON.stringify(s)),Object.assign(Object.assign({},n),t))};function lt(r,e,t,s,n,i){return be(this,void 0,void 0,function*(){return new Promise((o,a)=>{r(t,To(e,s,n,i)).then(l=>{if(!l.ok)throw l;return s!=null&&s.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>So(l,a,s))})})}function Rt(r,e,t,s){return be(this,void 0,void 0,function*(){return lt(r,"GET",e,t,s)})}function he(r,e,t,s,n){return be(this,void 0,void 0,function*(){return lt(r,"POST",e,s,n,t)})}function Oo(r,e,t,s,n){return be(this,void 0,void 0,function*(){return lt(r,"PUT",e,s,n,t)})}function Po(r,e,t,s){return be(this,void 0,void 0,function*(){return lt(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function nn(r,e,t,s,n){return be(this,void 0,void 0,function*(){return lt(r,"DELETE",e,s,n,t)})}var M=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):n(c.value).then(a,l)}u((s=s.apply(r,e||[])).next())})};const Ao={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},rs={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class jo{constructor(e,t={},s,n){this.url=e,this.headers=t,this.bucketId=s,this.fetch=sn(n)}uploadOrUpdate(e,t,s,n){return M(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},rs),n);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=s,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),n!=null&&n.headers&&(a=Object.assign(Object.assign({},a),n.headers));const u=this._removeEmptyFolders(t),c=this._getFinalPath(u),h=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:i,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{})),d=yield h.json();return h.ok?{data:{path:u,id:d.Id,fullPath:d.Key},error:null}:{data:null,error:d}}catch(i){if(x(i))return{data:null,error:i};throw i}})}upload(e,t,s){return M(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,n){return M(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let l;const u=Object.assign({upsert:rs.upsert},n),c=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&s instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",s)):typeof FormData<"u"&&s instanceof FormData?(l=s,l.append("cacheControl",u.cacheControl)):(l=s,c["cache-control"]=`max-age=${u.cacheControl}`,c["content-type"]=u.contentType);const h=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:c}),d=yield h.json();return h.ok?{data:{path:i,fullPath:d.Key},error:null}:{data:null,error:d}}catch(l){if(x(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return M(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=yield he(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:n}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new kr("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(s){if(x(s))return{data:null,error:s};throw s}})}update(e,t,s){return M(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return M(this,void 0,void 0,function*(){try{return{data:yield he(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(x(n))return{data:null,error:n};throw n}})}copy(e,t,s){return M(this,void 0,void 0,function*(){try{return{data:{path:(yield he(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(x(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,s){return M(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield he(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const o=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(x(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,s){return M(this,void 0,void 0,function*(){try{const n=yield he(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(x(n))return{data:null,error:n};throw n}})}download(e,t){return M(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Rt(this.fetch,`${this.url}/${n}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(x(a))return{data:null,error:a};throw a}})}info(e){return M(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield Rt(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ir(s),error:null}}catch(s){if(x(s))return{data:null,error:s};throw s}})}exists(e){return M(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Po(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(x(s)&&s instanceof nr){const n=s.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),n=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&n.push(l);let u=n.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${s}${u}`)}}}remove(e){return M(this,void 0,void 0,function*(){try{return{data:yield nn(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(x(t))return{data:null,error:t};throw t}})}list(e,t,s){return M(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Ao),t),{prefix:e||""});return{data:yield he(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},s),error:null}}catch(n){if(x(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const $o="2.7.1",Ro={"X-Client-Info":`storage-js/${$o}`};var Re=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):n(c.value).then(a,l)}u((s=s.apply(r,e||[])).next())})};class Co{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},Ro),t),this.fetch=sn(s)}listBuckets(){return Re(this,void 0,void 0,function*(){try{return{data:yield Rt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(x(e))return{data:null,error:e};throw e}})}getBucket(e){return Re(this,void 0,void 0,function*(){try{return{data:yield Rt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(x(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Re(this,void 0,void 0,function*(){try{return{data:yield he(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(x(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return Re(this,void 0,void 0,function*(){try{return{data:yield Oo(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(x(s))return{data:null,error:s};throw s}})}emptyBucket(e){return Re(this,void 0,void 0,function*(){try{return{data:yield he(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(x(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Re(this,void 0,void 0,function*(){try{return{data:yield nn(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(x(t))return{data:null,error:t};throw t}})}}class xo extends Co{constructor(e,t={},s){super(e,t,s)}from(e){return new jo(this.url,this.headers,e,this.fetch)}}const Io="2.48.1";let Ze="";typeof Deno<"u"?Ze="deno":typeof document<"u"?Ze="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ze="react-native":Ze="node";const Lo={"X-Client-Info":`supabase-js-${Ze}/${Io}`},Do={headers:Lo},Uo={schema:"public"},No={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Mo={};var Bo=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):n(c.value).then(a,l)}u((s=s.apply(r,e||[])).next())})};const qo=r=>{let e;return r?e=r:typeof fetch>"u"?e=Gs:e=fetch,(...t)=>e(...t)},Fo=()=>typeof Headers>"u"?Ks:Headers,Jo=(r,e,t)=>{const s=qo(t),n=Fo();return(i,o)=>Bo(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:r;let u=new n(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",r),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),s(i,Object.assign(Object.assign({},o),{headers:u}))})};var zo=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):n(c.value).then(a,l)}u((s=s.apply(r,e||[])).next())})};function Ho(r){return r.replace(/\/$/,"")}function Vo(r,e){const{db:t,auth:s,realtime:n,global:i}=r,{db:o,auth:a,realtime:l,global:u}=e,c={db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},a),s),realtime:Object.assign(Object.assign({},l),n),global:Object.assign(Object.assign({},u),i),accessToken:()=>zo(this,void 0,void 0,function*(){return""})};return r.accessToken?c.accessToken=r.accessToken:delete c.accessToken,c}const on="2.67.3",Go="http://localhost:9999",Ko="supabase.auth.token",Wo={"X-Client-Info":`gotrue-js/${on}`},ss=10,or="X-Supabase-Api-Version",an={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Yo(r){return Math.round(Date.now()/1e3)+r}function Xo(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const W=()=>typeof window<"u"&&typeof document<"u",ye={tested:!1,writable:!1},rt=()=>{if(!W())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ye.tested)return ye.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),ye.tested=!0,ye.writable=!0}catch{ye.tested=!0,ye.writable=!1}return ye.writable};function Qo(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((s,n)=>{e[n]=s}),e}const ln=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>De(async()=>{const{default:s}=await Promise.resolve().then(()=>Fe);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Zo=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",cn=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},ft=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},_t=async(r,e)=>{await r.removeItem(e)};function ea(r){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",s,n,i,o,a,l,u,c=0;for(r=r.replace("-","+").replace("_","/");c<r.length;)o=e.indexOf(r.charAt(c++)),a=e.indexOf(r.charAt(c++)),l=e.indexOf(r.charAt(c++)),u=e.indexOf(r.charAt(c++)),s=o<<2|a>>4,n=(a&15)<<4|l>>2,i=(l&3)<<6|u,t=t+String.fromCharCode(s),l!=64&&n!=0&&(t=t+String.fromCharCode(n)),u!=64&&i!=0&&(t=t+String.fromCharCode(i));return t}class Nt{constructor(){this.promise=new Nt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Nt.promiseConstructor=Promise;function ns(r){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=r.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const s=t[1];return JSON.parse(ea(s))}async function ta(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function ra(r,e){return new Promise((s,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await r(i);if(!e(i,null,o)){s(o);return}}catch(o){if(!e(i,o)){n(o);return}}})()})}function sa(r){return("0"+r.toString(16)).substr(-2)}function na(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,sa).join("")}async function ia(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(s);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}function oa(r){return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function aa(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await ia(r);return oa(t)}async function Ce(r,e,t=!1){const s=na();let n=s;t&&(n+="/PASSWORD_RECOVERY"),await cn(r,`${e}-code-verifier`,n);const i=await aa(s);return[i,s===i?"plain":"s256"]}const la=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function ca(r){const e=r.headers.get(or);if(!e||!e.match(la))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class Er extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function g(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class ua extends Er{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function ha(r){return g(r)&&r.name==="AuthApiError"}class un extends Er{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ke extends Er{constructor(e,t,s,n){super(e,s,n),this.name=t,this.status=s}}class ae extends ke{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function da(r){return g(r)&&r.name==="AuthSessionMissingError"}class Ht extends ke{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class vt extends ke{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class pt extends ke{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function fa(r){return g(r)&&r.name==="AuthImplicitGrantRedirectError"}class is extends ke{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ar extends ke{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Vt(r){return g(r)&&r.name==="AuthRetryableFetchError"}class os extends ke{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}var _a=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};const me=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),va=[502,503,504];async function as(r){var e;if(!Zo(r))throw new ar(me(r),0);if(va.includes(r.status))throw new ar(me(r),r.status);let t;try{t=await r.json()}catch(i){throw new un(me(i),i)}let s;const n=ca(r);if(n&&n.getTime()>=an["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new os(me(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new ae}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new os(me(t),r.status,t.weak_password.reasons);throw new ua(me(t),r.status||500,s)}const pa=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),t))};async function w(r,e,t,s){var n;const i=Object.assign({},s==null?void 0:s.headers);i[or]||(i[or]=an["2024-01-01"].name),s!=null&&s.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const o=(n=s==null?void 0:s.query)!==null&&n!==void 0?n:{};s!=null&&s.redirectTo&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await ga(r,e,t+a,{headers:i,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(l):{data:Object.assign({},l),error:null}}async function ga(r,e,t,s,n,i){const o=pa(e,s,n,i);let a;try{a=await r(t,Object.assign({},o))}catch(l){throw console.error(l),new ar(me(l),0)}if(a.ok||await as(a),s!=null&&s.noResolveJson)return a;try{return await a.json()}catch(l){await as(l)}}function le(r){var e;let t=null;ba(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=Yo(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function ls(r){const e=le(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function de(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function ya(r){return{data:r,error:null}}function ma(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i}=r,o=_a(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function wa(r){return r}function ba(r){return r.access_token&&r.refresh_token&&r.expires_in}var ka=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};class Ea{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=ln(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await w(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(g(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await w(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:de})}catch(s){if(g(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=ka(e,["options"]),n=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(n.new_email=s==null?void 0:s.newEmail,delete n.newEmail),await w(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:ma,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(g(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await w(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:de})}catch(t){if(g(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,n,i,o,a,l;try{const u={nextPage:null,lastPage:0,total:0},c=await w(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:wa});if(c.error)throw c.error;const h=await c.json(),d=(o=c.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=c.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(_=>{const v=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),p=JSON.parse(_.split(";")[1].split("=")[1]);u[`${p}Page`]=v}),u.total=parseInt(d)),{data:Object.assign(Object.assign({},h),u),error:null}}catch(u){if(g(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){try{return await w(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:de})}catch(t){if(g(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await w(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:de})}catch(s){if(g(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await w(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:de})}catch(s){if(g(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await w(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:s}}catch(t){if(g(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await w(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(g(t))return{data:null,error:t};throw t}}}const Sa={getItem:r=>rt()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{rt()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{rt()&&globalThis.localStorage.removeItem(r)}};function cs(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function Ta(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const xe={debug:!!(globalThis&&rt()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class hn extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Oa extends hn{}async function Pa(r,e,t){xe.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),xe.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){xe.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,n.name);try{return await t()}finally{xe.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,n.name)}}else{if(e===0)throw xe.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new Oa(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(xe.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Ta();const Aa={url:Go,storageKey:Ko,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Wo,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},Ye=30*1e3,us=3;async function hs(r,e,t){return await t()}class nt{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=nt.nextInstanceID,nt.nextInstanceID+=1,this.instanceID>0&&W()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},Aa),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Ea({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=ln(n.fetch),this.lock=n.lock||hs,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:W()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=Pa:this.lock=hs,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:rt()?this.storage=Sa:(this.memoryStorage={},this.storage=cs(this.memoryStorage)):(this.memoryStorage={},this.storage=cs(this.memoryStorage)),W()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${on}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Qo(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),W()&&this.detectSessionInUrl&&s!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),fa(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return g(t)?{error:t}:{error:new un("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,n;try{const i=await w(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:le}),{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(i){if(g(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,n;try{let i;if("email"in e){const{email:c,password:h,options:d}=e;let f=null,_=null;this.flowType==="pkce"&&([f,_]=await Ce(this.storage,this.storageKey)),i=await w(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d==null?void 0:d.emailRedirectTo,body:{email:c,password:h,data:(t=d==null?void 0:d.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:f,code_challenge_method:_},xform:le})}else if("phone"in e){const{phone:c,password:h,options:d}=e;i=await w(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:c,password:h,data:(s=d==null?void 0:d.data)!==null&&s!==void 0?s:{},channel:(n=d==null?void 0:d.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:le})}else throw new vt("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(i){if(g(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:a}=e;t=await w(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:ls})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=await w(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:ls})}else throw new vt("You must provide either an email or phone number and a password");const{data:s,error:n}=t;return n?{data:{user:null,session:null},error:n}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new Ht}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(t){if(g(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await ft(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(t??"").split("/");try{const{data:i,error:o}=await w(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:le});if(await _t(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Ht}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if(g(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:n,access_token:i,nonce:o}=e,a=await w(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:le}),{data:l,error:u}=a;return u?{data:{user:null,session:null},error:u}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Ht}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:u})}catch(t){if(g(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,n,i,o;try{if("email"in e){const{email:a,options:l}=e;let u=null,c=null;this.flowType==="pkce"&&([u,c]=await Ce(this.storage,this.storageKey));const{error:h}=await w(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(s=l==null?void 0:l.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:u,code_challenge_method:c},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:a,options:l}=e,{data:u,error:c}=await w(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(n=l==null?void 0:l.data)!==null&&n!==void 0?n:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:c}}throw new vt("You must provide either an email or phone number.")}catch(a){if(g(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,s;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:a}=await w(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:le});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,u=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(n){if(g(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,s,n;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await Ce(this.storage,this.storageKey)),await w(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:ya})}catch(i){if(g(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new ae;const{error:n}=await w(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(g(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:i}=e,{error:o}=await w(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:s,type:n,options:i}=e,{data:o,error:a}=await w(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new vt("You must provide either an email or phone number and a type")}catch(t){if(g(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await ft(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,u,c)=>(!o&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,u,c))})}return{data:{session:e},error:null}}const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await w(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:de}):await this._useSession(async t=>{var s,n,i;const{data:o,error:a}=t;if(a)throw a;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ae}:await w(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:de})})}catch(t){if(g(t))return da(t)&&(await this._removeSession(),await _t(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:n,error:i}=s;if(i)throw i;if(!n.session)throw new ae;const o=n.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Ce(this.storage,this.storageKey));const{data:u,error:c}=await w(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:de});if(c)throw c;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(s){if(g(s))return{data:{user:null},error:s};throw s}}_decodeJWT(e){return ns(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ae;const t=Date.now()/1e3;let s=t,n=!0,i=null;const o=ns(e.access_token);if(o.exp&&(s=o.exp,n=s<=t),n){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(g(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new ae;const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(g(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!W())throw new pt("No browser detected.");if(e.error||e.error_description||e.error_code)throw new pt(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new is("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new pt("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new is("No code detected.");const{data:A,error:T}=await this._exchangeCodeForSession(e.code);if(T)throw T;const j=new URL(window.location.href);return j.searchParams.delete("code"),window.history.replaceState(window.history.state,"",j.toString()),{data:{session:A.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:u}=e;if(!i||!a||!o||!u)throw new pt("No session defined in URL");const c=Math.round(Date.now()/1e3),h=parseInt(a);let d=c+h;l&&(d=parseInt(l));const f=d-c;f*1e3<=Ye&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${h}s`);const _=d-h;c-_>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",_,d,c):c-_<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",_,d,c);const{data:v,error:p}=await this._getUser(i);if(p)throw p;const y={provider_token:s,provider_refresh_token:n,access_token:i,expires_in:h,expires_at:d,refresh_token:o,token_type:u,user:v.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:e.type},error:null}}catch(s){if(g(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await ft(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{error:i};const o=(s=n.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(ha(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await _t(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Xo(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,n;try{const{data:{session:i},error:o}=t;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await Ce(this.storage,this.storageKey,!0));try{return await w(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(g(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(g(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:n}=await this._useSession(async i=>{var o,a,l,u,c;const{data:h,error:d}=i;if(d)throw d;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await w(this.fetch,"GET",f,{headers:this.headers,jwt:(c=(u=h.session)===null||u===void 0?void 0:u.access_token)!==null&&c!==void 0?c:void 0})});if(n)throw n;return W()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(g(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:o}=t;if(o)throw o;return await w(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(g(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await ra(async n=>(n>0&&await ta(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await w(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:le})),(n,i)=>{const o=200*Math.pow(2,n);return i&&Vt(i)&&Date.now()+o-s<Ye})}catch(s){if(this._debug(t,"error",s),g(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),W()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await ft(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const n=Math.round(Date.now()/1e3),i=((e=s.expires_at)!==null&&e!==void 0?e:1/0)<n+ss;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${ss}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:o}=await this._callRefreshToken(s.refresh_token);o&&(console.error(o),Vt(o)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new ae;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Nt;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new ae;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={session:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(n,"error",i),g(i)){const o={session:null,error:i};return Vt(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,s=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await cn(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await _t(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&W()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ye);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((s.expires_at*1e3-e)/Ye);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${Ye}ms, refresh threshold is ${us} ticks`),n<=us&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof hn)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!W()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const n=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,o]=await Ce(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(a.toString())}if(s!=null&&s.queryParams){const i=new URLSearchParams(s.queryParams);n.push(i.toString())}return s!=null&&s.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await w(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(g(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:o}=t;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:u}=await w(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((n=l==null?void 0:l.totp)===null||n===void 0)&&n.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(g(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:a}=await w(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(g(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await w(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(g(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],n=s.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=s.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:s,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const o=this._decodeJWT(n.access_token);let a=null;o.aal&&(a=o.aal);let l=a;((s=(t=n.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(l="aal2");const c=o.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:c},error:null}}))}}nt.nextInstanceID=0;const ja=nt;class $a extends ja{constructor(e){super(e)}}var Ra=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(h){o(h)}}function l(c){try{u(s.throw(c))}catch(h){o(h)}}function u(c){c.done?i(c.value):n(c.value).then(a,l)}u((s=s.apply(r,e||[])).next())})};class Ca{constructor(e,t,s){var n,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=Ho(e);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;const l=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,u={db:Uo,realtime:Mo,auth:Object.assign(Object.assign({},No),{storageKey:l}),global:Do},c=Vo(s??{},u);this.storageKey=(n=c.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=c.global.headers)!==null&&i!==void 0?i:{},c.accessToken?(this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(h,d)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(d)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=c.auth)!==null&&o!==void 0?o:{},this.headers,c.global.fetch),this.fetch=Jo(t,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.rest=new so(`${a}/rest/v1`,{headers:this.headers,schema:c.db.schema,fetch:this.fetch}),c.accessToken||this._listenForAuthEvents()}get functions(){return new Ji(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new xo(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Ra(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,storageKey:i,flowType:o,lock:a,debug:l},u,c){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new $a({url:this.authUrl,headers:Object.assign(Object.assign({},h),u),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,flowType:o,lock:a,debug:l,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new mo(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const xa=(r,e,t)=>new Ca(r,e,t),Ia="https://vdvnlvflxrcyvltzcque.supabase.co",La="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZkdm5sdmZseHJjeXZsdHpjcXVlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk2OTY3MjIsImV4cCI6MjA1NTI3MjcyMn0.AOrk4cXU4jO1BFccWfhUUIwS4JNqyEKsT4JX-2dpjMc",Sr=xa(Ia,La),dn=$i([]);async function Tr(){const{data:r,error:e}=await Sr.from("regions").select("*");e?console.error("Error fetching regions:",e):dn.set(r)}Tr();async function Da(r){const{data:e,error:t}=await Sr.from("regions").insert([r]);t?console.error("Error adding region:",t):await Tr()}async function Ua(r){const{error:e}=await Sr.from("regions").delete().match({id:r});e?console.error("Error deleting region:",e):await Tr()}const Na="/Bolger-Field-Tracker/assets/map-image-DxNZ7SkT.png";var Ma=qe('<div class="expanded-info svelte-1jrl5mo"><h3> </h3> <p> </p> <button>Close</button> <button class="delete-btn svelte-1jrl5mo">Delete</button></div>');function Ba(r,e){hr(e,!1);let t=yt(e,"region",8),s=yt(e,"onClose",8,()=>{}),n=yt(e,"onDelete",8,()=>{});Vs();var i=Ma(),o=z(i),a=z(o),l=I(o,2),u=z(l),c=I(l,2),h=I(c,2);Xe(()=>{$t(a,t().name),$t(u,t().details)}),Z("click",c,function(...d){var f;(f=s())==null||f.apply(this,d)}),Z("click",h,()=>n()(t())),ce(r,i),dr()}var qa=qe('<button class="svelte-1yxncvs">Create Region</button>'),Fa=qe('<div class="create-region-panel svelte-1yxncvs"><h3>Creating a new region</h3> <label class="svelte-1yxncvs">Name: <input placeholder="Region name"></label> <label class="svelte-1yxncvs">Info: <input placeholder="Short info"></label> <button class="svelte-1yxncvs">Save Region</button> <button style="margin-left:10px;" class="svelte-1yxncvs">Cancel</button></div>'),Ja=zs('<polygon></polygon><text class="region-label svelte-1yxncvs"> </text>',1),za=zs('<polygon class="new-region-preview svelte-1yxncvs"></polygon>'),Ha=qe('<div class="hover-info svelte-1yxncvs"> </div>'),Va=qe('<div class="top-panel svelte-1yxncvs"><!> <!></div> <div><svg class="map-svg svelte-1yxncvs" viewBox="0 0 2648 1582" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg"><image x="0" y="0" width="2648" height="1582"></image><!><!></svg> <!> <!></div>',1);function Ga(r,e){hr(e,!1);let t=ge(null),s=ge(null),n=ge(!1),i=ge([]),o=ge(""),a=ge(""),l=ge([]);const u=dn.subscribe(m=>{R(l,m)});xi(()=>{u()});function c(m){R(s,m)}function h(m,k){b(n)||(k.stopPropagation(),R(t,m))}function d(){R(n,!0),R(i,[]),R(o,""),R(a,""),R(t,null)}function f(m){if(!b(n))return;const k=m.currentTarget.getBoundingClientRect(),L=2648/k.width,N=1582/k.height,F=m.clientX-k.left,J=m.clientY-k.top,V=Math.round(F*L),oe=Math.round(J*N);R(i,[...b(i),`${V},${oe}`])}async function _(){if(!b(o).trim()||b(i).length<3){alert("Please provide a region name and at least 3 points.");return}const m={name:b(o).trim(),points:b(i).join(" "),info:b(a).trim()||"Short info on hover",details:"Expanded details on click"};await Da(m),R(n,!1),R(i,[]),R(o,""),R(a,"")}function v(){R(n,!1),R(i,[]),R(o,""),R(a,"")}async function p(m){await Ua(m.id),R(t,null)}function y(){R(t,null)}function A(m){const k=m.trim().split(" ").map(J=>J.split(",").map(Number));let L=0,N=0,F=0;for(let J=0;J<k.length;J++){const[V,oe]=k[J],[Ee,jr]=k[(J+1)%k.length],Mt=V*jr-Ee*oe;L+=Mt,N+=(V+Ee)*Mt,F+=(oe+jr)*Mt}return L/=2,N/=6*L,F/=6*L,{x:N,y:F}}Vs();var T=Va(),j=xr(T),E=z(j);{var ct=m=>{var k=qa();Z("click",k,d),ce(m,k)};Ve(E,m=>{b(n)||m(ct)})}var Je=I(E,2);{var ze=m=>{var k=Fa(),L=I(z(k),2),N=I(z(L)),F=I(L,2),J=I(z(F)),V=I(F,2),oe=I(V,2);Br(N,()=>b(o),Ee=>R(o,Ee)),Br(J,()=>b(a),Ee=>R(a,Ee)),Z("click",V,_),Z("click",oe,v),ce(m,k)};Ve(Je,m=>{b(n)&&m(ze)})}var ut=I(j,2),He=z(ut),Or=z(He);Ge(Or,"href",Na);var Pr=I(Or);Ei(Pr,1,()=>b(l),bi,(m,k)=>{var L=Ja(),N=xr(L),F=I(N),J=z(F);Xe((V,oe)=>{Ge(N,"points",b(k).points),Ai(N,`region ${(b(n)?"no-pointer":"")??""} svelte-1yxncvs`),Ge(F,"x",V),Ge(F,"y",oe),$t(J,b(k).name)},[()=>A(b(k).points).x,()=>A(b(k).points).y],kt),Z("mouseover",N,()=>c(b(k))),Z("mouseout",N,()=>R(s,null)),Z("click",N,V=>h(b(k),V)),ce(m,L)});var fn=I(Pr);{var _n=m=>{var k=za();Xe(L=>Ge(k,"points",L),[()=>b(i).join(" ")],kt),ce(m,k)};Ve(fn,m=>{b(n)&&b(i).length>=2&&m(_n)})}var Ar=I(He,2);{var vn=m=>{var k=Ha(),L=z(k);Xe(()=>$t(L,b(s).info)),ce(m,k)};Ve(Ar,m=>{b(s)&&m(vn)})}var pn=I(Ar,2);{var gn=m=>{Ba(m,{get region(){return b(t)},onClose:y,onDelete:p})};Ve(pn,m=>{b(t)&&m(gn)})}Xe(()=>ji(ut,`map-container ${(b(n)?"create-mode":"")??""} svelte-1yxncvs`)),Z("click",He,f),ce(r,T),dr()}var Ka=qe('<main class="svelte-19w2whe"><h1 class="svelte-19w2whe">Haras de la Gesse Field Mapping</h1> <!></main>');function Wa(r,e){yt(e,"name",8);var t=Ka(),s=I(z(t),2);Ga(s,{}),ce(r,t)}yi(Wa,{target:document.getElementById("app")});export{zi as g};
